Wee.fn.make("tiles",{init:function(a,b){var c=this,d=Wee.$extend({columns:2,gridName:a,gridSelector:"ref:"+a,tileSelector:"ref:weeTile",callback:null},b),e=$(d.gridSelector),f=$(d.tileSelector,d.gridSelector);e.addClass("wee-grid"),f.addClass("wee-grid__entry"),this.$set("conf",d),this.$set("$grid",e),this.$set("$tiles",f),this.$set(d.gridName,{totalTiles:Wee.$toArray(f)}),this.$private("checkLoadingImages",this.$get("$tiles"),function(){c.$private("buildColumns"),c.$private("calculateLayout"),c.$private("buildLayout"),d.callback&&d.callback()})},append:function(a,b){var c=this,d=Wee.$extend({columns:this.$get(a).columns,gridName:a,gridSelector:"ref:"+a,callback:null},b),e=$("ref:"+a),f=Wee.$parseHTML('<div class="wee-tile-is-hidden" data-ref="tempDiv"></div>',!0),g=b.tiles;this.$get(a).totalTiles.push(g),this.$set("conf",d),this.$set("$tiles",g),f.append(g),e.append(f),this.$private("checkLoadingImages",this.$get("$tiles"),function(){var b=c.$private("calculateLayout",!0),e=$("ref:weeColumn");c.$private("buildLayout",b),c.$get(a).columnData.forEach(function(a,c){a.elements=a.elements.concat(b[c].elements),a.totalHeight=e[c].offsetHeight}),f.remove(),d.callback&&d.callback()})},update:function(a,b){var c=this,d={columns:b||2,gridName:a,gridSelector:"ref:"+a,tileSelector:"ref:weeTile"},e=$(d.gridSelector),f=$(d.tileSelector,d.gridSelector);this.$set("conf",d),e.empty(),e.append(f),Wee.$setRef(d.gridSelector),this.$set("$grid",e),this.$set("$tiles",f),this.$private("checkLoadingImages",this.$get("$tiles"),function(){c.$private("buildColumns"),c.$private("calculateLayout",!1,!0),c.$private("buildLayout")})}},{checkLoadingImages:function(a,b){var c=a.find("img").map(function(a){return a.src});Wee.assets.load({files:c,success:b})},buildColumns:function(){for(var a=[],b=0;b<this.$get("conf").columns;b++)a.push('<div class="wee-grid__column --columns-'+this.$get("conf").columns+'" data-ref="weeColumn"></div>');this.$get("$grid").append(Wee.$parseHTML(a.join(""))),Wee.$setRef(this.$get("conf").gridSelector)},calculateLayout:function(a,b){var c,d=b||!1,e=this.buildColumnDataStructure(d),f=this.$get("conf").columns,g=$("ref:weeColumn").last().width(),h=this.$get(this.$get("conf").gridName);return c=this.getTileHeights(this.$get("$tiles"),g,b),this.assignTiles(c,e,b),a?e:(h.columnData=e,void(h.columns=f))},buildLayout:function(a){var b=$("ref:weeColumn"),c=this.$get(this.$get("conf").gridName),d=a||c.columnData;d.forEach(function(a,c){a.elements.forEach(function(a){$(a).css("width",""),b.eq(c).append(a)})}),Wee.$setRef()},buildColumnDataStructure:function(a){for(var b=[],c=this.$get(this.$get("conf").gridName),d=0;d<this.$get("conf").columns;d++)b.push({elements:[],totalHeight:c.columnData&&!a?c.columnData[d].totalHeight:0});return b},getTileHeights:function(a,b,c){var d=[],e=this.$get(this.$get("conf").gridName);return c?(e.totalTiles.forEach(function(a){d.push(a.map(function(a){return $(a).css("width",b+"px"),a.offsetHeight}))}),d):a.map(function(a){return $(a).css("width",b+"px"),a.offsetHeight})},assignTiles:function(a,b,c){var d=this,e=this.$get("conf").gridName,f=d.$get(e);c?a.forEach(function(a,e){d.assignTilesLogic(a,b,f,c,e)}):this.assignTilesLogic(a,b,f)},assignTilesLogic:function(a,b,c,d,e){var f=this;d&&(c.smallestCol=0),a.forEach(function(a,g){var h=c.smallestCol||0===c.smallestCol?c.smallestCol:null;b.forEach(function(a,c){(null===h||a.totalHeight<b[h].totalHeight)&&(h=c)}),b[h].elements.push(d?c.totalTiles[e][g]:f.$get("$tiles")[g]),b[h].totalHeight+=a,c.smallestCol=h})}});
//# sourceMappingURL=../../wee/maps/wee-tiles-script.js.map